# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

commands:
  command-lint_and_test:
    steps:
      - run:
          name: UIKit for React build and test
          command: |
            yarn run eslint
            yarn run eslint-ts
            yarn run test

          no_output_timeout: 30m

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  job-lint_and_test:
    docker:
      - image: cimg/node:16.19.1
    steps:
      - checkout
      - run: node --version
      - run: corepack enable
      - run: corepack prepare yarn@stable --activate
      - run: yarn --version
      - run: yarn install
      # todo: cache node_modules
      # - save_cache:
      #   paths:
      #       - node_modules
      #   key: yarn-deps-{{ checksum "yarn.lock" }}-{{ epoch }}
      - command-lint_and_test

# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  built-and-test:
    jobs:
      - job-lint_and_test:
          filters:
            branches:
              ignore:
                - main
                - develop-v3
